<div class="container mt-3">
  <h1><%= @project.name %></h1>


  <div class="cards-container">
    <div class="row">
     <% if @progress_percent.nan? %>
      <p><%=@project.status%></p>
     <% else %>
      <% if @progress_percent == 0 %>
        <div class="progress p-0" style="height: 30px;">
           <div class="progress-bar bg-danger" role="progressbar" style="width: 100%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">0% completed</div>
        </div>
        <% elsif @progress_percent == 100 %>
        <div class="progress p-0" style="height: 30px;">
          <div class="progress-bar bg-success" role="progressbar" style="width: <%=@progress_percent.to_i%>%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100">100% completed!</div>
        </div>
      <% elsif @progress_percent < 50 %>
        <div class="progress p-0" style="height: 30px;">
          <div class="progress-bar bg-info" role="progressbar" style="width: <%=@progress_percent.to_i%>%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"><%=@progress_percent.to_i%>% completed</div>
        </div>
      <% else %>
        <div class="progress p-0" style="height: 30px;">
          <div class="progress-bar bg-success" role="progressbar" style="width: <%=@progress_percent.to_i%>%" aria-valuenow="25" aria-valuemin="0" aria-valuemax="100"><%=@progress_percent.to_i%>% completed</div>
        </div>
      <% end %>
    <%end%>

      <div class="col-2">
        <p class="well bg-light"><%= @project.due_date %></p>
      </div>
      <div class="col-2">
        <%= link_to 'Chatroom', chatroom_path(@project.chatroom) %>
      </div>
    </div><!--.row-->

    <div class= "row">
      <div class="col-3">
        <p class="well bg-light">Description: <%= @project.description %></p>   <!--descriptiion-->

         <div class="well bg-light"><p>Files</p>    <!--attached files-->
            <% if @project.files.attached? %>
              <% @project.files.each do |file| %>
                <% if file.image? %>
                    <%= image_tag(file, :width => "260px")%>
                    <%= link_to 'remove file', project_file_path(@project, file), method: 'delete'%>
                <% else %>
                  <div class="container">
                    <%= link_to file.filename, rails_blob_path(file, disposition: "attachement"), target: "_blank"%>
                    <%= link_to 'remove file', project_file_path(@project, file), method: 'delete'%>
                  </div>
                <% end %>
              <% end %>
            <% else %>
              <p> No files attached yet </p>
            <% end %>
          </div>
      </div>

      <div class="col-9">
        <h3>Tasks</h3>
        <div class="search-bar">
          <div class="col-auto icon-col">
            <i class="fas fa-search element-icon" aria-hidden="true"></i>
          </div>
          <div class="col-11">


            <%= form_tag projects_path, method: :get, :class => 'input-group' do %>
              <%= text_field_tag :query,
                params[:query],
                class: "form-control-project",
                placeholder:  'Find a task'
              %>
            <% end %>
          </div>
        </div>


        <ul class="list-group"> <!--task list-->
          <% @tasks.each do |task| %>
            <li class="list-group-item">
              <div class="row">
                <div class="col">
                  <%= link_to task.name, task_path(task)%>
                  (<%= task.status %>)
                  <% task.users.each do |user| %>
                    <% if user.avatar.attached? %>
                      <button type="button", class="btn-avatar", data-toggle="tooltip" data-placement="top" title="<%= user.name %>">
                          <%= image_tag user.avatar, class: "avatar-large dropdown-toggle", id: "navbarDropdown",
                          data: { bs_toggle: "dropdown" }, 'aria-haspopup': true, 'aria-expanded': false %>
                      </button>
                    <% end %>
                  <%end%>
                </div>
              </div>
            </li>
          <% end %>
        </ul>

        <%= link_to new_project_task_path(@project), class: 'pull-right btn btn-default' do %>
        <i class="fas fa-plus"></i> Add a task
        <% end %>
      </div>
    </div><!--.row-->
  </div><!--.container-->

  <div class="container">

    <%= link_to edit_project_path(@project), class: 'pull-right btn btn-default' do %>
      <i class="fas fa-edit"></i> Edit this project
    <% end %>


    <%= link_to project_path(@project), class: 'pull-right btn btn-default', method: 'delete', data: { confirm: "Are you sure you want to delete?" }  do %>
      <i class="fas fa-trash-alt"></i> Delete this project
    <% end %>


  </div>

    <%= link_to projects_path, class: 'pull-right btn btn-default' do %>
      <i class="fa fa-history"></i> Back to list
    <% end %>
</div>
